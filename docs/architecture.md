# PetCare AI Fullstack Architecture Document

## Introduction

This document outlines the complete fullstack architecture for PetCare AI, including backend systems, frontend implementation, and their integration. It serves as the single source of truth for AI-driven development, ensuring consistency across the entire technology stack.

This unified approach combines what would traditionally be separate backend and frontend architecture documents, streamlining the development process for modern fullstack applications where these concerns are increasingly intertwined.

### Starter Template or Existing Project

The project's initial frontend structure will be based on the code generated by the **v0.dev platform**, as specified in the UI/UX workflow. This provides a modern Next.js and Tailwind CSS starter template, which we will build upon and integrate with our backend services.

### Change Log

| Date         | Version | Description                   | Author            |
| :----------- | :------ | :---------------------------- | :---------------- |
| 2025-07-27   | 1.0     | Initial architecture draft.   | Winston (Architect) |

## High Level Architecture

### Technical Summary

The system is designed as a modern, full-stack **serverless application**. The frontend, built with **Next.js**, will be served globally by **Vercel's Edge Network**. Backend logic will be handled by **Vercel Serverless Functions**, which will interact with our external services. All core data, user authentication, and file storage will be managed by **Supabase** as our Backend-as-a-Service (BaaS). The entire project will be contained within a **Monorepo** to streamline development and ensure type safety across the stack. This architecture prioritizes rapid development, scalability, and low operational overhead, perfectly aligning with our MVP goals.

### Platform and Infrastructure Choice

* **Platform:** **Vercel**.
* **Key Services:** Supabase (Database, Auth, Storage), Resend (Emails), Google Gemini API (AI Analysis).
* **Deployment Host and Regions:** Vercel's global edge network.

### Repository Structure

* **Structure:** **Monorepo**.
* **Monorepo Tool:** **Turborepo**.
* **Package Organization:** Standard `/apps` and `/packages` structure.

### High Level Architecture Diagram

This diagram illustrates the main components and data flows of the system. A User interacts with the PetCare App in their browser. The app is served by the Vercel Platform's Edge Network, and its API calls are handled by Vercel Serverless Functions. These functions interact with Supabase for data/auth, and with the Gemini and Resend APIs for AI and email services. Vercel Cron Jobs also trigger the serverless functions for scheduled tasks.

### Architectural and Design Patterns

* **Serverless Architecture:** Using Vercel Functions for all backend logic.
* **Backend-as-a-Service (BaaS):** Offloading core functionality to Supabase.
* **Component-Based UI:** Using React and Next.js.
* **API Layer via Serverless Functions:** Securely handling backend logic via Next.js API Routes.

## Tech Stack

### Technology Stack Table

| Category               | Technology              | Version | Purpose                                        |
| :--------------------- | :---------------------- | :------ | :--------------------------------------------- |
| Frontend Language      | TypeScript              | `~5.4`  | Type safety for the frontend.                  |
| Frontend Framework     | Next.js                 | `~14.2` | Primary framework for UI and API.              |
| UI Library             | React                   | `~18.3` | The underlying library for components.         |
| UI Components          | Shadcn/ui               | `latest`| Pre-built, accessible UI components.           |
| State Management       | Zustand                 | `~4.5`  | Simple, lightweight state management.          |
| Backend Language       | TypeScript              | `~5.4`  | Type safety for serverless functions.          |
| Backend Framework      | Next.js API Routes      | `~14.2` | Framework for serverless backend logic.        |
| Database               | PostgreSQL              | `15`    | Relational database via Supabase.              |
| File Storage           | Supabase Storage        | `latest`| Storing files like pet photos.                 |
| Authentication         | Supabase Auth           | `latest`| Manages user sign-up, login, sessions.       |
| Frontend Testing       | Jest / RTL              | `latest`| Unit and component testing.                    |
| E2E Testing            | Playwright              | `~1.44` | End-to-end testing of user flows.              |
| CI/CD                  | Vercel CI/CD            | `N/A`   | Automates testing and deployment.              |
| Monitoring             | Vercel Analytics        | `N/A`   | Performance and usage metrics.                 |
| CSS Framework          | Tailwind CSS            | `~3.4`  | Utility-first framework for styling.         |

## Data Models

### Pet
Represents a single pet belonging to a user.
- **Attributes:** id, created_at, user_id, name, breed, date_of_birth, photo_url.
- **Relationships:** Belongs to one User, has many Journal Entries, has many Events.

### JournalEntry
Represents a single, timestamped observation logged by a user.
- **Attributes:** id, created_at, user_id, pet_id, content, ai_advice.
- **Relationships:** Belongs to one User, belongs to one Pet.

### Event
Represents a future scheduled event for a pet.
- **Attributes:** id, created_at, user_id, pet_id, title, due_date, status, source.
- **Relationships:** Belongs to one User, belongs to one Pet.

## API Specification
API routes are built using Next.js API Routes. Authentication is handled by the Supabase client.
- **Pets API:** GET /api/pets, POST /api/pets, PUT /api/pets/[petId], DELETE /api/pets/[petId].
- **Journal API:** GET /api/pets/[petId]/journal, POST /api/pets/[petId]/journal.
- **Events API:** GET /api/pets/[petId]/events, PUT /api/events/[eventId].

## Components
- **1. Frontend Application:** Renders UI, handles user interactions.
- **2. Backend API Layer:** Handles business logic and security.
- **3. Supabase Service (BaaS):** Provides database, auth, and storage.
- **4. AI Service (Wrapper):** Manages all communication with the Gemini API.
- **5. Notification Service (Wrapper):** Manages all email sending via the Resend API.
- **6. Automated Scheduler:** Triggers daily background tasks via Vercel Cron.

## External APIs
- **Google Gemini API:** Provides AI analysis and content generation.
- **Resend API:** Sends all transactional emails.

## Core Workflows
Sequence diagrams have been defined for:
- **Journal Entry & AI Analysis Workflow:** Details the interactive flow when a user saves a journal entry.
- **Automated Event Notification Workflow:** Details the asynchronous background job for sending notifications.

## Database Schema
A complete PostgreSQL DDL script is defined, including tables for `profiles`, `pets`, `journal_entries`, and `events`. Crucially, it includes **Row Level Security (RLS) policies** for each table to ensure users can only access their own data.

## Frontend Architecture
- **Component Organization:** A structure using `/ui`, `/features`, and `/layouts` folders.
- **State Management:** Zustand for simple global state.
- **Routing:** Next.js App Router with middleware for protected routes.
- **Services:** A typed data-access layer for communicating with the backend API.

## Backend Architecture
- **Service Architecture:** Serverless functions via Next.js API Route Handlers.
- **Data Access:** A dedicated service layer (`/packages/services`) to interact with Supabase.
- **Authentication:** Server-side session validation on every secure API request.

## Unified Project Structure
A detailed ASCII tree diagram is defined for the monorepo, showing the placement of apps, shared packages, and configuration files.

## Development Workflow
- **Setup:** Standard `git clone`, `npm install`, and `.env.local` setup.
- **Run:** `npm run dev` from the root to start the application.

## Deployment, Testing, & Standards
- **Deployment:** Continuous Deployment to Vercel via Git.
- **Testing:** A testing pyramid of Unit (Jest/RTL), Integration, and E2E (Playwright) tests.
- **Standards:** Critical coding standards for AI agents are defined, focusing on type sharing, service layer usage, localization, and security.

## Final Validation
- **Readiness:** High. The architecture is comprehensive, validated, and ready for development.

petcare-ai/
├── .github/
│   └── /workflows/
│       └── ci.yaml             # Vercel deployment is handled by its git integration
├── apps/
│   └── web/                    # The Next.js full-stack application
│       ├── /public/            # Static assets (images, fonts)
│       └── /src/
│           ├── /app/             # Next.js App Router
│           │   ├── /(auth)/      # Route group for auth pages
│           │   │   ├── /login/
│           │   │   │   └── page.tsx
│           │   │   └── /signup/
│           │   │       └── page.tsx
│           │   ├── /dashboard/   # Main protected dashboard route
│           │   │   └── page.tsx
│           │   ├── /api/         # Backend API routes (Serverless Functions)
│           │   │   ├── /pets/
│           │   │   │   └── ... (route.ts files as defined in Backend Architecture)
│           │   │   └── /events/
│           │   │       └── ...
│           │   ├── layout.tsx    # Root layout
│           │   └── page.tsx      # Landing page
│           ├── /components/      # React components
│           │   ├── /ui/          # Shadcn/ui base components
│           │   ├── /features/    # Feature-specific components (e.g., PetSwitcher)
│           │   └── /layouts/     # Page layouts (e.g., DashboardLayout)
│           ├── /lib/             # Helper functions & utilities
│           │   ├── /api/         # Frontend functions for calling our API
│           │   └── supabase.ts   # Supabase client setup
│           └── /stores/          # Zustand state management stores
│       ├── middleware.ts         # Authentication middleware for route protection
│       └── package.json
├── packages/
│   ├── /config/                # Shared configurations
│   │   ├── eslint-preset.js
│   │   └── tsconfig.base.json
│   ├── /services/              # Backend Data Access Layer (e.g., pet-service.ts)
│   └── /shared-types/          # Shared TypeScript interfaces (Pet, Event, etc.)
├── docs/
│   ├── prd.md
│   ├── ui-ux-specification.md
│   └── architecture.md
├── package.json                # Root package.json for the monorepo
└── turbo.json                  # Turborepo configuration